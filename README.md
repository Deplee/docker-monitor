# Docker Container Monitor

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU –∏ RAM –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ CPU –∏ RAM –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- üåê **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Docker daemon –Ω–∞ –¥—Ä—É–≥–∏—Ö –º–∞—à–∏–Ω–∞—Ö
- üìà **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–º—è—Ç–∏, —Å–µ—Ç–∏, CPU
- ‚ö° **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –∑–∞–¥–∞–Ω–Ω–æ–π —á–∞—Å—Ç–æ—Ç–æ–π
- üéØ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- üìã **–°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –∫—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
sudo apt update
sudo apt install -y libcurl4-openssl-dev libjson-c-dev build-essential
```

### –°–±–æ—Ä–∫–∞

```bash
git clone <repository>
cd docker_monitor
make
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ —Å–∏—Å—Ç–µ–º—É

```bash
sudo make install
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–ª–æ–∫–∞–ª—å–Ω—ã–π —Ö–æ—Å—Ç)
./docker_monitor

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 10 —Å–µ–∫—É–Ω–¥
./docker_monitor -i 10

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
./docker_monitor -c my_container

# –¢–æ–ª—å–∫–æ —Å–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
./docker_monitor -s
```

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ö–æ—Å—Ç—ã

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É Docker daemon
./docker_monitor -H 192.168.1.100

# –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ö–æ—Å—Ç —Å –¥—Ä—É–≥–∏–º –ø–æ—Ä—Ç–æ–º
./docker_monitor -H docker.example.com -p 2376

# –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ö–æ—Å—Ç —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º
./docker_monitor -H 172.29.205.104 -c test-container -i 5
```

### –í—Å–µ –æ–ø—Ü–∏–∏

```bash
./docker_monitor [–æ–ø—Ü–∏–∏]

–û–ø—Ü–∏–∏:
  -h, --help           –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
  -v, --version        –ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é
  -i <—Å–µ–∫—É–Ω–¥—ã>         –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5)
  -c <–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä>       –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
  -j                   –í—ã–≤–æ–¥ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
  -s                   –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–¥–∫—É
  -H <—Ö–æ—Å—Ç>            Docker —Ö–æ—Å—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: localhost)
  -p <–ø–æ—Ä—Ç>            Docker –ø–æ—Ä—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2375)
  --tls                –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TLS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
  --cert <–ø—É—Ç—å>        –ü—É—Ç—å –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –∫–ª–∏–µ–Ω—Ç–∞
  --key <–ø—É—Ç—å>         –ü—É—Ç—å –∫ –∫–ª—é—á—É –∫–ª–∏–µ–Ω—Ç–∞
  --ca <–ø—É—Ç—å>          –ü—É—Ç—å –∫ CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker daemon –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É Docker daemon –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ –Ω–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ TCP –ø–æ—Ä—Ç–∞:

1. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª:**
```bash
sudo nano /etc/docker/daemon.json
```

2. **–î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
```json
{
  "hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2375"]
}
```

3. **–°–æ–∑–¥–∞–π—Ç–µ override –¥–ª—è systemd:**
```bash
sudo mkdir -p /etc/systemd/system/docker.service.d
sudo tee /etc/systemd/system/docker.service.d/override.conf > /dev/null << 'EOF'
[Service]
ExecStart=
ExecStart=/usr/bin/dockerd
EOF
```

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker:**
```bash
sudo systemctl daemon-reload
sudo systemctl restart docker
```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:**
```bash
sudo systemctl status docker
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –û—Ç–∫—Ä—ã—Ç–∏–µ Docker daemon –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ TLS —Å–æ–∑–¥–∞–µ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç—å. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π—Ä–≤–æ–ª –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPN –∏–ª–∏ SSH —Ç—É–Ω–Ω–µ–ª–∏

## –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

### –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```
[14:21:48] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
----------------------------------------------------------------
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: test-container
ID: 844755c8a84a61ea11a8310a7b82272e884e12f48a9579ab42cb0418a5ad386
–û–±—Ä–∞–∑: nginx:alpine
–°—Ç–∞—Ç—É—Å: Up 5 minutes
–ü–∞–º—è—Ç—å: 2.73 MB / 2.73 MB (0.02%)
–°–µ—Ç—å RX: 7.30 KB | TX: 7.30 KB
CPU Usage: 48397000 | System: 5578660000000
-----
```

### –°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

```
[14:21:48] –°–≤–æ–¥–∫–∞: 1/1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–ø—É—â–µ–Ω–æ | –ü–∞–º—è—Ç—å: 2.73 MB / 2.73 MB
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
docker_monitor/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.c              # –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ docker_api.c        # API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Docker
‚îÇ   ‚îú‚îÄ‚îÄ container_stats.c   # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ utils.c             # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îú‚îÄ‚îÄ docker_monitor.h    # –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ docker_api.h        # API –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îú‚îÄ‚îÄ Makefile                # –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∫–∏
‚îî‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **Docker API Client** - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Docker daemon
- **JSON Parser** - –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤ Docker API
- **Network Layer** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Unix –∏ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **Statistics Engine** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

- **Unix Socket** - –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ `/var/run/docker.sock`
- **TCP Socket** - —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ IP:–ø–æ—Ä—Ç
- **TLS** - –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°–±–æ—Ä–∫–∞ —Å –æ—Ç–ª–∞–¥–∫–æ–π

```bash
make clean
make CFLAGS="-g -O0"
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –≤ `include/docker_monitor.h`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö `.c` —Ñ–∞–π–ª–∞—Ö
3. –î–æ–±–∞–≤—å—Ç–µ –æ–ø—Ü–∏–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ `src/main.c`
4. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –û—Ç–ª–∞–¥–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
./docker_monitor -H localhost -i 1

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
telnet localhost 2375
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É Docker daemon

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞:**
```bash
telnet <host> <port>
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Docker daemon:**
```bash
sudo systemctl status docker
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª:**
```bash
sudo ufw status
```

### –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Docker API

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Docker socket:**
```bash
sudo usermod -aG docker $USER
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Docker:**
```bash
sudo systemctl status docker
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å, –Ω–æ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤.

## –õ–∏—Ü–µ–Ω–∑–∏—è

[MIT LICENSE](LICENSE)
